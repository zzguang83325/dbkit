# DBKit vs GORM 性能对比报告

生成时间: 2026-01-09 19:00:59

## 测试环境

| 项目 | 值 |
|------|----|
| Go Version | go1.25.5 |
| OS/Arch | windows/amd64 |
| CPU Cores | 16 |
| Database | MySQL 127.0.0.1:3306 |

## 测试参数

| 参数 | 值 |
|------|----|
| 单条插入次数 | 1000 |
| 查询测试次数 | 1000 |
| 更新测试次数 | 500 |
| 批量操作大小 | 100 |

## 测试方法

为了确保测试的公平性和准确性，本测试采用以下方法：

1. **独立表测试**: DBKit 和 GORM 使用不同的表（`benchmark_users_dbkit` 和 `benchmark_users_gorm`），表结构相同,消除 MySQL 缓存效应的影响
2. **相同测试条件**: 两者使用相同的数据量、批量大小和测试次数
3. **事务一致性**: 批量插入测试中，两者都使用事务以确保公平对比
4. **预热处理**: 每个测试前都进行预热，避免冷启动影响

## 测试结果

| 测试项 | DBKit | GORM | DBKit ops/s | GORM ops/s | 对比 |
|--------|-------|------|-------------|------------|------|
| 单条插入 | 1.3361398s | 1.4542704s | 748 | 688 | DBKit 快 8.1% |
| 批量插入 | 17.9313ms | 17.9536ms | 55768 | 55699 | DBKit 快 0.1% |
| 单条查询 | 133.7865ms | 290.4602ms | 7475 | 3443 | DBKit 快 53.9% |
| 批量查询(100条) | 34.9639ms | 45.434ms | 2860 | 2201 | DBKit 快 23.0% |
| 条件查询 | 173.3263ms | 304.9913ms | 5769 | 3279 | DBKit 快 43.2% |
| 更新操作 | 636.1461ms | 745.025ms | 786 | 671 | DBKit 快 14.6% |
| 删除操作 | 621.3927ms | 748.1111ms | 805 | 668 | DBKit 快 16.9% |
| **总计** | **2.9536866s** | **3.6062456s** | - | - | - |

## 结论

**DBKit 总体快 18.1%**

### 分析

本次测试中，**DBKit 在所有测试项目上都超越了 GORM**，展现出全面的性能优势：

- **单条插入**: DBKit 快 8.1%
- **批量插入**: DBKit 快 0.1%
- **单条查询**: DBKit 快 53.9%
- **批量查询(100条)**: DBKit 快 23.0%
- **条件查询**: DBKit 快 43.2%
- **更新操作**: DBKit 快 14.6%
- **删除操作**: DBKit 快 16.9%

#### 性能优势原因

**为什么 DBKit 在大多数场景下领先？**

1. **无反射开销**: Record 模式使用 `map[string]interface{}`，避免了结构体反射的性能损耗
2. **轻量级设计**: 默认关闭时间戳和乐观锁检查，减少不必要的开销
**单条查询为什么优势最大（53.9%）？**

在此场景下，DBKit 的轻量级设计和无反射开销带来了显著的性能优势。

**GORM 的优势场景**

GORM 在以下场景仍有其价值：
- **复杂 ORM 功能**: 关联查询、预加载、钩子回调
- **数据库迁移**: 自动迁移和版本管理
- **生态系统**: 丰富的插件和社区支持

**总体评价**: DBKit 在大多数 CRUD 操作上都表现出色，总体性能快 18.1%，特别适合追求高性能的场景。

### 性能优化说明

DBKit 默认关闭了时间戳自动更新、乐观锁和软删除功能，以获得最佳性能。如需启用这些功能：

```go
// 启用时间戳自动更新
dbkit.EnableTimestamps()

// 启用乐观锁功能
dbkit.EnableOptimisticLock()

// 启用软删除功能
dbkit.EnableSoftDelete()
```

启用这些功能后，相关操作会有额外的处理开销，但仍然保持良好的性能。

### 技术差异

| 特性 | DBKit Record | GORM |
|------|--------------|------|
| 数据结构 | map[string]interface{} | 结构体反射 |
| 字段映射 | 无需映射 | 需要反射解析 tag |
| 内置功能 | 时间戳、乐观锁、软删除（可选）、SQL模板 | 钩子、关联、迁移 |
| 灵活性 | 动态字段 | 固定结构体 |
| 性能特点 | 轻量级，低开销 | 功能丰富，开销较高 |

