# DBKit vs GORM  性能对比报告

生成时间: 2026-01-10 18:53:14

> **⚠️ 重要提示**：本报告中的测试结果仅供参考。实际性能会因硬件配置、网络环境、数据库配置、系统负载等多种因素而有显著差异。请在您自己的环境中运行测试，以获得最准确的性能数据。

## 测试环境

| 项目 | 值 |
|------|----|
| Go Version | go1.25.5 |
| OS/Arch | windows/amd64 |
| CPU Cores | 16 |
| Database | PostgreSQL  |
| 数据库驱动 | pgx/v5 (统一驱动) |

## 测试参数

| 参数 | 值 |
|------|----|
| 单条插入次数 | 5000 |
| 查询测试次数 | 10000 |
| 更新测试次数 | 2000 |
| 删除测试次数 | 2000 |
| 批量操作大小 | 200 |
| 并发协程数 | 100 |
| 每协程操作数 | 500 |
| 压力测试时长 | 3 秒 |
| 最大连接数 | 100 |

## 测试方法

为了确保测试的公平性和准确性，本测试采用以下方法：

1. **顺序测试架构**: DBKit 和 GORM 分别测试，避免同时连接数据库造成连接数翻倍
2. **统一驱动**: 两者都使用相同的 pgx/v5 PostgreSQL 驱动，确保底层性能基准一致
3. **独立表测试**: DBKit 和 GORM 使用不同的表（`benchmark_users_dbkit` 和 `benchmark_users_gorm`），表结构相同
4. **相同测试条件**: 使用相同的数据量、批量大小和测试次数
5. **连接池管理**: 每个测试阶段独立管理连接池，测试完成后立即释放连接
6. **资源等待**: 每次切换框架前等待2秒，确保连接完全释放

## 基础性能测试结果

| 测试项 | DBKit | GORM | DBKit ops/s | GORM ops/s | 对比 |
|--------|-------|------|-------------|------------|------|
| 并发单条插入 | 162.2583ms | 173.8674ms | 30815 | 28758 | DBKit 快 6.7% |
| 批量插入 | 40.0806ms | 45.7345ms | 124749 | 109327 | DBKit 快 12.4% |
| 并发查询测试 | 136.3448ms | 143.6531ms | 73343 | 69612 | DBKit 快 5.1% |
| 并发更新测试 | 74.2748ms | 127.5289ms | 26927 | 15683 | DBKit 快 41.8% |
| 并发删除测试 | 67.9199ms | 86.7332ms | 29446 | 23059 | DBKit 快 21.7% |
| **总计** | **480.8784ms** | **577.5171ms** | - | - | - |

## 结论

**DBKit 总体快 16.7%**

> **📊 测试结果说明**：以上结果基于特定的测试环境和配置。不同的硬件配置（CPU、内存、存储）、网络延迟、数据库服务器配置、系统负载等因素都会显著影响测试结果。建议您在自己的生产环境或类似环境中进行测试，以获得最具参考价值的性能数据。

### 分析

#### 性能对比分析
本次测试中：

- **并发单条插入**: DBKit 快 6.7%
- **批量插入**: DBKit 快 12.4%
- **并发查询测试**: DBKit 快 5.1%
- **并发更新测试**: DBKit 快 41.8%
- **并发删除测试**: DBKit 快 21.7%

#### DBKit性能优势原因

1. **无反射开销**: Record 模式使用 `map[string]interface{}`，避免了结构体反射的性能损耗
2. **轻量级设计**: 默认关闭时间戳和乐观锁检查，减少不必要的开销
3. **优化的SQL生成**: 直接生成SQL语句，减少中间层处理
4. **统一驱动优势**: 使用相同的pgx/v5驱动，消除了驱动差异的影响

GORM 在以下场景的优势：
- **复杂 ORM 功能**: 关联查询、预加载、钩子回调
- **数据库迁移**: 自动迁移和版本管理
- **生态系统**: 丰富的插件和社区支持
- **开发效率**: 结构体映射和类型安全

**总体评价**: DBKit 在基础 CRUD 操作上都表现出色，总体性能快 16.7%。

## 渐进式并发压力测试结果

本次测试采用渐进式并发压力测试方法，在不同协程数量下使用相同的测试条件进行对比：

- **测试方法**: 渐进式增加并发协程数量
- **测试条件**: 每个级别使用相同的测试时长和操作混合比例
- **操作混合**: 70%查询 + 20%插入 + 10%更新
- **测试目标**: 找到不同并发级别下的性能表现和稳定性临界点

### 渐进式测试汇总对比表格

| 并发协程数 | DBKit TPS | GORM TPS | DBKit成功率 | GORM成功率 | 性能优势 | 内存对比 |
|-----------|-----------|----------|-------------|------------|----------|----------|
| 100 | 94471 | 52529 | 100.0% | 100.0% | DBKit快80% | GORM少3.3MB |
| 300 | 90315 | 52787 | 100.0% | 100.0% | DBKit快71% | GORM少2.6MB |
| 500 | 84770 | 38402 | 100.0% | 100.0% | DBKit快121% | DBKit少0.2MB |
| 1000 | 87233 | 29644 | 100.0% | 100.0% | DBKit快194% | GORM少2.1MB |
| 5000 | 78777 | 24873 | 100.0% | 100.0% | DBKit快217% | DBKit少27.1MB |

### 各并发级别详细对比

#### 100并发级别详细对比

| 测试项目 | DBKit | GORM | 对比 |
|----------|-------|------|------|
| 并发协程数 | 100 | 100 | 相同 |
| 测试持续时间 | 3.0084773s | 3.0131698s | - |
| 总操作数 | 284213 | 158278 | - |
| 成功操作数 | 284213 | 158278 | - |
| 失败操作数 | 0 | 0 | - |
| 成功率 | 100.00% | 100.00% | 相同 |
| **TPS性能** | **94471 ops/s** | **52529 ops/s** | **DBKit快79.8%** |
| 内存占用 | 7.58 MB | 4.27 MB | GORM少3.31MB |
| GC次数 | 372 | 656 | - |
| 性能等级 | ⚡ 高性能 | ⚡ 高性能 | - |

#### 300并发级别详细对比

| 测试项目 | DBKit | GORM | 对比 |
|----------|-------|------|------|
| 并发协程数 | 300 | 300 | 相同 |
| 测试持续时间 | 3.0122558s | 3.0219762s | - |
| 总操作数 | 272051 | 159521 | - |
| 成功操作数 | 272051 | 159521 | - |
| 失败操作数 | 0 | 0 | - |
| 成功率 | 100.00% | 100.00% | 相同 |
| **TPS性能** | **90315 ops/s** | **52787 ops/s** | **DBKit快71.1%** |
| 内存占用 | 6.83 MB | 4.19 MB | GORM少2.65MB |
| GC次数 | 883 | 1100 | - |
| 性能等级 | ⚡ 高性能 | ⚡ 高性能 | - |

#### 500并发级别详细对比

| 测试项目 | DBKit | GORM | 对比 |
|----------|-------|------|------|
| 并发协程数 | 500 | 500 | 相同 |
| 测试持续时间 | 3.0255501s | 3.0292073s | - |
| 总操作数 | 256475 | 116329 | - |
| 成功操作数 | 256475 | 116329 | - |
| 失败操作数 | 0 | 0 | - |
| 成功率 | 100.00% | 100.00% | 相同 |
| **TPS性能** | **84770 ops/s** | **38402 ops/s** | **DBKit快120.7%** |
| 内存占用 | 7.31 MB | 7.52 MB | DBKit少0.21MB |
| GC次数 | 1297 | 1428 | - |
| 性能等级 | ⚡ 高性能 | ✅ 良好性能 | - |

#### 1000并发级别详细对比

| 测试项目 | DBKit | GORM | 对比 |
|----------|-------|------|------|
| 并发协程数 | 1000 | 1000 | 相同 |
| 测试持续时间 | 3.0192636s | 3.0972682s | - |
| 总操作数 | 263378 | 91814 | - |
| 成功操作数 | 263378 | 91814 | - |
| 失败操作数 | 0 | 0 | - |
| 成功率 | 100.00% | 100.00% | 相同 |
| **TPS性能** | **87233 ops/s** | **29644 ops/s** | **DBKit快194.3%** |
| 内存占用 | 9.92 MB | 7.84 MB | GORM少2.08MB |
| GC次数 | 1585 | 1655 | - |
| 性能等级 | ⚡ 高性能 | ✅ 良好性能 | - |

#### 5000并发级别详细对比

| 测试项目 | DBKit | GORM | 对比 |
|----------|-------|------|------|
| 并发协程数 | 5000 | 5000 | 相同 |
| 测试持续时间 | 3.0623796s | 3.2457154s | - |
| 总操作数 | 241246 | 80730 | - |
| 成功操作数 | 241246 | 80730 | - |
| 失败操作数 | 0 | 0 | - |
| 成功率 | 100.00% | 100.00% | 相同 |
| **TPS性能** | **78777 ops/s** | **24873 ops/s** | **DBKit快216.7%** |
| 内存占用 | 12.87 MB | 39.97 MB | DBKit少27.09MB |
| GC次数 | 1704 | 1724 | - |
| 性能等级 | ⚡ 高性能 | ✅ 良好性能 | - |

### 渐进式测试分析

渐进式并发压力测试通过逐步增加并发协程数，全面评估了两个框架在不同负载下的性能表现：

- 🚀 **DBKit最佳性能**: 100并发时达到94471 TPS
- 📊 **GORM最佳稳定性能**: 300并发时达到52787 TPS 

渐进式测试验证了DBKit在各个并发级别下都保持了优异的性能和稳定性表现。

## 技术差异对比

| 特性 | DBKit Record | GORM |
|------|--------------|------|
| 数据结构 | map[string]interface{} | 结构体反射 |
| 字段映射 | 无需映射 | 需要反射解析 tag |
| 数据库驱动 | pgx/v5 | pgx/v5 |
| 连接管理 | 顺序测试，独立连接池 | 顺序测试，独立连接池 |
| 内置功能 | 时间戳、乐观锁、软删除（可选）、SQL模板 | 钩子、关联、迁移 |
| 灵活性 | 动态字段 | 固定结构体 |
| 性能特点 | 轻量级，低开销 | 功能丰富，开销较高 |
| 适用场景 | 高性能CRUD，微服务 | 复杂业务逻辑，快速开发 |

## 使用建议

### 选择 DBKit 的场景
- 🚀 **高性能要求**: 需要极致的CRUD性能
- 🔧 **微服务架构**: 轻量级，资源消耗少
- 📊 **数据密集型应用**: 大量的数据库操作
- ⚡ **实时系统**: 对延迟敏感的应用

### 选择 GORM 的场景
- 🏗️ **复杂业务逻辑**: 需要丰富的ORM功能
- 👥 **团队开发**: 需要类型安全和开发效率
- 🔄 **数据库迁移**: 需要自动迁移功能
- 🌐 **生态系统**: 需要丰富的插件支持

## 测试环境说明

- **测试方式**: 顺序测试，避免连接数问题
- **驱动统一**: 两者都使用pgx/v5驱动
- **连接池配置**: 最大连接数100，空闲连接数10
- **测试数据**: 使用独立的测试表，避免缓存干扰
- **资源管理**: 每个测试阶段独立管理连接和资源

---

## 免责声明

本性能测试报告仅供技术参考，测试结果会因以下因素而产生差异：

- **硬件环境**：CPU型号、核心数、内存大小、存储类型（SSD/HDD）
- **网络环境**：网络延迟、带宽、连接稳定性
- **数据库配置**：PostgreSQL版本、配置参数、缓存设置
- **系统负载**：其他应用程序的资源占用
- **测试时机**：系统状态、缓存预热情况

**建议**：请在您的实际部署环境中进行测试，以获得最准确的性能评估。

---

*本报告由 DBKit 性能测试程序自动生成*
*测试程序位置: `examples/benchmark/main.go`*
