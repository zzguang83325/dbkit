# åˆ†é¡µå‡½æ•°æµ‹è¯•ç¤ºä¾‹

è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº† dbkit ä¸­å„ç§åˆ†é¡µåŠŸèƒ½çš„ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬æ–°çš„ `PaginateSQL` æ–¹æ³•å’Œä¼ ç»Ÿçš„ `Paginate` æ–¹æ³•ã€‚

## åŠŸèƒ½æ¼”ç¤º

### 1. åŸºæœ¬ PaginateSQL ç”¨æ³•
- ä½¿ç”¨å®Œæ•´ SQL è¯­å¥è¿›è¡Œåˆ†é¡µæŸ¥è¯¢
- è‡ªåŠ¨å¤„ç†åˆ†é¡µé€»è¾‘
- è¿”å›å¼ºç±»å‹ç»“æœ

### 2. ä¼ ç»Ÿ Paginate æ–¹æ³•å¯¹æ¯”
- å±•ç¤ºä¼ ç»Ÿåˆ†é¡µæ–¹æ³•çš„ç”¨æ³•
- å¯¹æ¯”æ–°æ—§æ–¹æ³•çš„å·®å¼‚

### 3. å¤æ‚æŸ¥è¯¢åˆ†é¡µ
- æ”¯æŒèšåˆæŸ¥è¯¢ã€GROUP BYã€HAVING ç­‰å¤æ‚ SQL
- æ¼”ç¤ºå¦‚ä½•å¤„ç†ç»Ÿè®¡æŸ¥è¯¢çš„åˆ†é¡µ

### 4. å¸¦ç¼“å­˜çš„åˆ†é¡µ
- æ¼”ç¤ºç¼“å­˜æœºåˆ¶çš„ä½¿ç”¨
- å±•ç¤ºç¼“å­˜å¯¹æ€§èƒ½çš„æå‡æ•ˆæœ

### 5. å…¨å±€åˆ†é¡µå‡½æ•°
- ä½¿ç”¨å…¨å±€ `PaginateSQL` å‡½æ•°
- è¿”å›é€šç”¨çš„ Record ç±»å‹ç»“æœ

### 6. JOIN æŸ¥è¯¢åˆ†é¡µ âœ…
- **INNER JOIN**: ç”¨æˆ·å’Œéƒ¨é—¨ä¿¡æ¯å…³è”æŸ¥è¯¢ï¼Œæ”¯æŒè–ªèµ„ç­›é€‰
- **LEFT JOIN**: ç”¨æˆ·è®¢å•ç»Ÿè®¡ï¼Œæ”¯æŒ GROUP BY å’Œ HAVING å­å¥
- æ¼”ç¤ºå¤šè¡¨å…³è”çš„å¤æ‚åˆ†é¡µåœºæ™¯

### 7. å­æŸ¥è¯¢åˆ†é¡µ âœ…
- **æ ‡é‡å­æŸ¥è¯¢**: é«˜äºå¹³å‡è–ªèµ„çš„å‘˜å·¥æŸ¥è¯¢ï¼Œè®¡ç®—è–ªèµ„å·®å€¼
- **EXISTS å­æŸ¥è¯¢**: æœ‰å®Œæˆè®¢å•çš„ç”¨æˆ·ç­›é€‰
- **IN å­æŸ¥è¯¢**: è´­ä¹°è¿‡ç‰¹å®šç±»åˆ«äº§å“çš„ç”¨æˆ·æŸ¥è¯¢ï¼Œæ”¯æŒå¤šå±‚åµŒå¥—

### 8. çª—å£å‡½æ•°å’Œé«˜çº§èšåˆ âœ…
- **ROW_NUMBER**: éƒ¨é—¨å†…è–ªèµ„æ’åï¼Œæ”¯æŒåˆ†åŒºæ’åº
- **RANK**: å¸¦å¹¶åˆ—æ’åçš„è–ªèµ„ç»Ÿè®¡
- **èšåˆçª—å£å‡½æ•°**: ç´¯è®¡è®¢å•é‡‘é¢å’Œç§»åŠ¨å¹³å‡å€¼è®¡ç®—

### 9. å¤æ‚å¤šè¡¨å…³è”æŸ¥è¯¢ âœ…
- **äº”è¡¨å…³è”**: ç”¨æˆ·-éƒ¨é—¨-è®¢å•-è®¢å•é¡¹-äº§å“å®Œæ•´å…³è”æŸ¥è¯¢
- **å¤æ‚èšåˆç»Ÿè®¡**: éƒ¨é—¨é”€å”®ä¸šç»©å¤šç»´åº¦åˆ†æï¼ŒåŒ…å«é¢„ç®—å®Œæˆç‡
- **é«˜ä»·å€¼å®¢æˆ·åˆ†æ**: åŸºäºæ¶ˆè´¹é‡‘é¢çš„å®¢æˆ·åˆ†çº§å’Œæ’åº

## è¿è¡Œå‰å‡†å¤‡

### 1. å®‰è£… MySQL
ç¡®ä¿ä½ çš„ç³»ç»Ÿä¸Šå®‰è£…äº† MySQL æœåŠ¡å™¨å¹¶æ­£åœ¨è¿è¡Œã€‚

### 2. åˆ›å»ºæ•°æ®åº“
```sql
CREATE DATABASE test_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 3. ä¿®æ”¹æ•°æ®åº“è¿æ¥
ç¼–è¾‘ `main.go` æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼š

```go
// ä¿®æ”¹è¿™è¡Œä»£ç ä¸­çš„è¿æ¥å‚æ•°
dsn := "root:password@tcp(localhost:3306)/test_db?charset=utf8mb4&parseTime=True&loc=Local"
```

å‚æ•°è¯´æ˜ï¼š
- `root`: MySQL ç”¨æˆ·å
- `password`: MySQL å¯†ç 
- `localhost:3306`: MySQL æœåŠ¡å™¨åœ°å€å’Œç«¯å£
- `test_db`: æ•°æ®åº“åç§°

## è¿è¡Œç¤ºä¾‹

### æ–¹æ³•1ï¼šåŸºç¡€åŠŸèƒ½æµ‹è¯•ï¼ˆæ— éœ€ MySQLï¼‰
```bash
# è¿›å…¥ç¤ºä¾‹ç›®å½•
cd examples/pagination_demo

# å®‰è£…ä¾èµ–
go mod tidy

# è¿è¡ŒåŸºç¡€åŠŸèƒ½æµ‹è¯•
go run test_basic.go models.go
```

### æ–¹æ³•2ï¼šå®Œæ•´åŠŸèƒ½æ¼”ç¤ºï¼ˆéœ€è¦ MySQLï¼‰
```bash
# è¿›å…¥ç¤ºä¾‹ç›®å½•
cd examples/pagination_demo

# å®‰è£…ä¾èµ–
go mod tidy

# è¿è¡Œå®Œæ•´ç¤ºä¾‹ï¼ˆæ¨èæ–¹å¼ï¼‰
go run .

# æˆ–è€…æ˜ç¡®æŒ‡å®šæ–‡ä»¶
go run main.go models.go
```

**æ³¨æ„**ï¼šä¸è¦åªè¿è¡Œ `go run main.go`ï¼Œå› ä¸ºè¿™æ ·ä¼šç¼ºå°‘ `models.go` ä¸­çš„ `User` ç±»å‹å®šä¹‰ï¼Œå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚

## é¢„æœŸè¾“å‡º

è¿è¡ŒæˆåŠŸåï¼Œä½ å°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š

```
ğŸš€ åˆ†é¡µå‡½æ•°æµ‹è¯•ç¤ºä¾‹ - MySQL æ•°æ®åº“
=====================================
âœ… MySQL æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ… æµ‹è¯•æ•°æ®å‡†å¤‡å®Œæˆ

ğŸ“Š å¼€å§‹åˆ†é¡µåŠŸèƒ½æ¼”ç¤º...

1ï¸âƒ£ åŸºæœ¬ PaginateSQL ç”¨æ³•æ¼”ç¤º
--------------------------------
ğŸ“„ æŸ¥è¯¢æ¡ä»¶: å¹´é¾„ > 25ï¼ŒæŒ‰å¹´é¾„å‡åºæ’åˆ—
ğŸ“Š åˆ†é¡µä¿¡æ¯: ç¬¬ 1 é¡µï¼Œæ¯é¡µ 10 æ¡ï¼Œå…± 39 æ¡è®°å½•ï¼Œå…± 4 é¡µ
ğŸ“‹ æŸ¥è¯¢ç»“æœ:
   ID: 56, å§“å: ç”¨æˆ·6, å¹´é¾„: 26, çŠ¶æ€: active
   ID: 96, å§“å: ç”¨æˆ·46, å¹´é¾„: 26, çŠ¶æ€: inactive
   ...

2ï¸âƒ£ ä¼ ç»Ÿ Paginate æ–¹æ³•å¯¹æ¯”
--------------------------------
ğŸ“„ æŸ¥è¯¢æ¡ä»¶: å¹´é¾„ > 25ï¼ŒæŒ‰å¹´é¾„å‡åºæ’åˆ— (ä¼ ç»Ÿæ–¹æ³•)
ğŸ“Š åˆ†é¡µä¿¡æ¯: ç¬¬ 1 é¡µï¼Œæ¯é¡µ 10 æ¡ï¼Œå…± 39 æ¡è®°å½•ï¼Œå…± 4 é¡µ
ğŸ“‹ ç»“æœæ•°é‡: 10 æ¡è®°å½•
ğŸ’¡ ä¼ ç»Ÿæ–¹æ³•éœ€è¦åˆ†åˆ«æŒ‡å®š WHERE å’Œ ORDER BY å­å¥

3ï¸âƒ£ å¤æ‚æŸ¥è¯¢åˆ†é¡µæ¼”ç¤º
--------------------------------
ğŸ“„ æŸ¥è¯¢: æŒ‰çŠ¶æ€åˆ†ç»„ç»Ÿè®¡ï¼Œå¹´é¾„åœ¨ 20-50 ä¹‹é—´ï¼Œç”¨æˆ·æ•° > 5
ğŸ“Š åˆ†é¡µä¿¡æ¯: ç¬¬ 1 é¡µï¼Œæ¯é¡µ 10 æ¡ï¼Œå…± 3 æ¡è®°å½•
ğŸ“‹ ç»Ÿè®¡ç»“æœ:
   çŠ¶æ€: inactive, ç”¨æˆ·æ•°: 14, å¹³å‡å¹´é¾„: 31.6, å¹´é¾„èŒƒå›´: 20-48
   çŠ¶æ€: pending, ç”¨æˆ·æ•°: 14, å¹³å‡å¹´é¾„: 32.6, å¹´é¾„èŒƒå›´: 21-49
   çŠ¶æ€: active, ç”¨æˆ·æ•°: 13, å¹³å‡å¹´é¾„: 33.8, å¹´é¾„èŒƒå›´: 22-50
ğŸ’¡ PaginateSQL æ”¯æŒå¤æ‚çš„èšåˆæŸ¥è¯¢å’Œåˆ†ç»„

4ï¸âƒ£ å¸¦ç¼“å­˜çš„åˆ†é¡µæ¼”ç¤º
--------------------------------
ğŸ“„ æŸ¥è¯¢æ¡ä»¶: çŠ¶æ€ä¸º 'active' çš„ç”¨æˆ·
ğŸ“Š ç¬¬ä¸€æ¬¡æŸ¥è¯¢è€—æ—¶: 1.8ms (æ•°æ®åº“æŸ¥è¯¢)
ğŸ“Š ç¬¬äºŒæ¬¡æŸ¥è¯¢è€—æ—¶: 0s (ç¼“å­˜è·å–)
ğŸ“Š ç¼“å­˜åŠ é€Ÿæ¯”: +Infx
ğŸ“‹ æŸ¥è¯¢ç»“æœ: 8 æ¡è®°å½•
ğŸ’¡ ç¼“å­˜å¯ä»¥æ˜¾è‘—æå‡é‡å¤æŸ¥è¯¢çš„æ€§èƒ½

5ï¸âƒ£ å…¨å±€åˆ†é¡µå‡½æ•°æ¼”ç¤º
--------------------------------
ğŸ“„ æŸ¥è¯¢æ¡ä»¶: å¹´é¾„åœ¨ 30-45 ä¹‹é—´ï¼ŒæŒ‰å¹´é¾„é™åºæ’åˆ—
ğŸ“Š åˆ†é¡µä¿¡æ¯: ç¬¬ 1 é¡µï¼Œæ¯é¡µ 12 æ¡ï¼Œå…± 17 æ¡è®°å½•
ğŸ“‹ ä¸­å¹´ç”¨æˆ·åˆ—è¡¨:
   ID: 75, å§“å: ç”¨æˆ·25, å¹´é¾„: 45, é‚®ç®±: user25@example.com
   ...
ğŸ’¡ å…¨å±€å‡½æ•°è¿”å› Record ç±»å‹ï¼Œé€‚åˆåŠ¨æ€æŸ¥è¯¢

ğŸ‰ æ‰€æœ‰åˆ†é¡µåŠŸèƒ½æ¼”ç¤ºå®Œæˆï¼
```

## æ•…éšœæ’é™¤

### è¿æ¥å¤±è´¥
å¦‚æœçœ‹åˆ°è¿æ¥å¤±è´¥çš„é”™è¯¯ï¼š
```
âš ï¸  MySQL æ•°æ®åº“è¿æ¥å¤±è´¥: ...
```

è¯·æ£€æŸ¥ï¼š
1. MySQL æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
2. è¿æ¥å‚æ•°æ˜¯å¦æ­£ç¡®ï¼ˆç”¨æˆ·åã€å¯†ç ã€ä¸»æœºã€ç«¯å£ï¼‰
3. æ•°æ®åº“æ˜¯å¦å­˜åœ¨
4. ç”¨æˆ·æ˜¯å¦æœ‰è¶³å¤Ÿçš„æƒé™

### ä¾èµ–é—®é¢˜
å¦‚æœé‡åˆ°ä¾èµ–é—®é¢˜ï¼Œè¿è¡Œï¼š
```bash
go mod tidy
go mod download
```

## ä»£ç è¯´æ˜

### æ¨¡å‹å®šä¹‰
```go
type User struct {
    dbkit.ModelCache
    ID        int64     `column:"id" json:"id"`
    Name      string    `column:"name" json:"name"`
    Email     string    `column:"email" json:"email"`
    Age       int64     `column:"age" json:"age"`
    Status    string    `column:"status" json:"status"`
    CreatedAt time.Time `column:"created_at" json:"created_at"`
}
```

### PaginateSQL æ–¹æ³•
```go
func (u *User) PaginateSQL(page int, pageSize int, querySQL string, args ...interface{}) (*dbkit.Page[*User], error) {
    db := dbkit.Use(u.DatabaseName())
    if cache := u.GetCache(); cache != nil && cache.CacheName != "" {
        db = db.Cache(cache.CacheName, cache.CacheTTL)
    }
    recordsPage, err := db.PaginateSQL(page, pageSize, querySQL, args...)
    if err != nil {
        return nil, err
    }
    return dbkit.RecordPageToDbModelPage[*User](recordsPage)
}
```

è¿™ä¸ªæ–¹æ³•å±•ç¤ºäº†ç”Ÿæˆå™¨ç”Ÿæˆçš„ PaginateSQL æ–¹æ³•çš„å®ç°é€»è¾‘ã€‚

## æ‰©å±•ç»ƒä¹ 

ä½ å¯ä»¥å°è¯•ï¼š

1. **ä¿®æ”¹æŸ¥è¯¢æ¡ä»¶**: æ”¹å˜ WHERE æ¡ä»¶ï¼Œæµ‹è¯•ä¸åŒçš„æŸ¥è¯¢åœºæ™¯
2. **è°ƒæ•´åˆ†é¡µå‚æ•°**: å°è¯•ä¸åŒçš„é¡µç å’Œé¡µé¢å¤§å°
3. **æ·»åŠ æ–°å­—æ®µ**: åœ¨ User æ¨¡å‹ä¸­æ·»åŠ æ–°å­—æ®µå¹¶æµ‹è¯•
4. **æµ‹è¯•å…¶ä»–æ•°æ®åº“**: å°†ç¤ºä¾‹æ”¹ä¸ºä½¿ç”¨ PostgreSQL æˆ– SQLite
5. **æ€§èƒ½æµ‹è¯•**: å¢åŠ æ›´å¤šæµ‹è¯•æ•°æ®ï¼Œæµ‹è¯•å¤§æ•°æ®é‡ä¸‹çš„åˆ†é¡µæ€§èƒ½

## ç›¸å…³æ–‡æ¡£

- [åˆ†é¡µå‡½æ•°é‡æ„è®¾è®¡æ–‡æ¡£](../../.kiro/specs/pagination-refactor/design.md)
- [ç”Ÿæˆå™¨ PaginateSQL ä½¿ç”¨æŒ‡å—](../../GENERATOR_PAGINATE_SQL_USAGE.md)
- [dbkit API æ–‡æ¡£](../../api.md)